{
  "title": "Chart Values",
  "type": "object",
  "properties": {
    "namespace": {
      "type": "object",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Specify whether to create the namespace",
          "default": true
        },
        "podSecurity": {
          "type": "object",
          "properties": {
            "audit": {
              "type": "string",
              "description": "The audit level for pod security",
              "default": "restricted"
            },
            "warn": {
              "type": "string",
              "description": "The warning level for pod security",
              "default": "restricted"
            },
            "enforce": {
              "type": "string",
              "description": "The enforcement level for pod security",
              "default": "restricted"
            }
          }
        }
      }
    },
    "k8s-store": {"$ref": "#/$defs/k8s-store"},
    "argocdNamespace": {
      "type": "string",
      "description": "The namespace where ArgoCD is installed",
      "default": "kube-argo-cd"
    },
    "projectRepoURL": {
      "type": "string",
      "description": "The project repoUrl",
      "default": "https://github.com/NValembois/argo-main.git"
    },
    "projectRepoPath": {
      "type": "string",
      "description": "The project path in the project repo",
      "default": "/"
    },
    "description": {
      "type": "string",
      "description": "A description for the project, using Helm template syntax",
      "default": "Projet '{{ $.Values.name }}'"
    },
    "additionalSourceRepos": {
      "type": "array",
      "description": "Additional source repositories for the project",
      "default": [],
      "items": {
        "type": "string"
      }
    },
    "sourceRepos": {
      "type": "array",
      "description": "Array of source repositories allowed for the project",
      "default": "[]",
      "items": {
        "type": "string"
      }
    },
    "additionnalDestinations": {
      "type": "array",
      "description": "Array of additional destinations allowed for the project",
      "default": "[]",
      "items": { "$ref": "#/$defs/destination"}
    },
    "destinations": {
      "type": "array",
      "description": "Array of destinations allowed for the project",
      "default": "[]",
      "items": { "$ref": "#/$defs/destination"}
    },
    "additionalClusterResourceWhitelist": {
      "type": "array",
      "description": "Additional cluster resources allowed for the project",
      "default": [],
      "items": { "$ref": "#/$defs/resource"}
    },
    "clusterResourceWhitelist": {
      "type": "array",
      "description": "Array of cluster resources allowed for the project",
      "default": "[]",
      "items": { "$ref": "#/$defs/resource"}
    },
    "additionalNamespaceResourceWhitelist": {
      "type": "array",
      "description": "Additional namespace resources whitelisted for the project",
      "default": "[]",
      "items": {"$ref": "#/$defs/resource"}
    },
    "namespaceResourceWhitelist": {
      "type": "array",
      "description": "Array of namespace resources whitelisted for the project",
      "default": "[]",
      "items": { "$ref": "#/$defs/resource"}
    },
    "orphanedResources": {
      "type": "object",
      "properties": {
        "warn": {
          "type": "boolean",
          "description": "Whether to warn about orphaned resources",
          "default": false
        }
      }
    },
    "roles": {
      "type": "array",
      "description": "Array of roles associated with the project",
      "default": "[]",
      "items": {
        "type": "string"
      }
    },
    "syncWindows": {
      "type": "array",
      "description": "Sync windows for the project",
      "default": [],
      "items": {}
    },
    "permitOnlyProjectScopedClusters": {
      "type": "boolean",
      "description": "Restrict to project-scoped clusters only",
      "default": false
    },
    "sourceNamespaces": {
      "type": "array",
      "description": "Array of source namespaces for the project",
      "default": "[]",
      "items": {
        "type": "string"
      }
    },
    "dependencies": {
      "type": "array",
      "description": "Array of project dependencies",
      "default": "[]",
      "items": {
        "type": "object",
        "properties": {
          "repository": {
            "type": "string",
            "description": "Repository URL for the dependency",
            "default": ""
          },
          "path": {
            "type": "string",
            "description": "Repository URL for the dependency",
            "default": ""
          },
          "alias": {
            "type": "string",
            "description": "Repository URL for the dependency",
            "default": ""
          },
          "version": {
            "type": "string",
            "description": "Repository URL for the dependency",
            "default": ""
          },
          "helm": {
            "type": "object",
            "properties": {
              "releaseName": {
                "type": "string",
                "description": "Release Name for helm dependency"
              },
              "valueFiles": {
                "type": "array",
                "description": "Value files for helm dependency",
                "items": {
                  "type": "string"
                }
              }
            },
            "ignoreDifferences": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "group": { "type": "string" },
                  "kind": { "type": "string" },
                  "jqPathExpressions": { 
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              }
            }
          },
          "addFinalizer": {
            "type": "boolean",
            "description": "Add argocd resources-finalzer to argocd application",
            "default": true
          },
          "syncPolicy": {"$ref":"#/$defs/syncPolicy"}
        }
      }
    },
    "applicationDefaults": {
      "type":"object",
      "properties": {
        "syncPolicy": {"$ref":"#/$defs/syncPolicy"}
      }
    }
  },
  "$defs": {
    "destination": {
      "type": "object",
      "properties": {
        "server": {
          "type": "string",
          "description": "The url of the destination cluster",
          "default": ""
        },
        "name": {
          "type": "string",
          "description": "The name of the destination cluster",
          "default": ""
        },
        "namespace": {
          "type": "string",
          "description": "The namespace in the destination cluster",
          "default": ""
        }
      },
      "additionalProperties": false,
      "anyOf": [
        { "required": [ "server" ] },
        { "required": [ "name" ] }
      ]
    },
    "resource": {
      "type": "object",
      "properties": {
        "group": {
          "type": "string",
          "description": "The group of the resource",
          "default": ""
        },
        "kind": {
          "type": "string",
          "description": "The kind of the resource",
          "default": ""
        }
      },
      "additionalProperties": false,
      "required": ["group","kind"]
    },
    "syncPolicy":{
      "type":"object",
      "properties": {
        "automated": {
          "type":"object",
          "properties": {
            "allowEmpty": {
              "type":"boolean",
              "default": false
            },
            "enabled": {
              "type":"boolean"
            },
            "selfHeal": {
              "type":"boolean",
              "default": true
            },
            "prune": {
              "type":"boolean",
              "default": true
            }
          }
        },
        "retry": {
          "type": "object",
          "properties": {
            "backoff": {
              "type": "object",
              "properties": {
                "duration": {
                  "type":"string",
                  "default": "5s"
                },
                "factor": {
                  "type":"integer",
                  "default": 2
                },
                "maxDuration": {
                  "type":"string",
                  "default": "3m0s"
                }
              }
            },
            "limit": {
              "type":"integer",
              "default": 2
            },
            "refresh": {
              "type":"integer",
              "default": 2
            }
          }
        },
        "syncOptions": {
          "type":"array",
          "default": [
            "ApplyOutOfSyncOnly=true",
            "PruneLast=true",
            "ServerSideApply=true",
            "RespectIgnoreDifferences=true"
          ],
          "items": {
            "type": "string"
          }
        }
      }
    },
    "k8s-store":{
      "type": "object",
      "namespace": {
          "type": "string",
          "description": "Objects namespace",
          "default": "{{ .Release.Namespace }}"
      },
      "name": {
          "type": "string",
          "description": "Objects name",
          "default": "{{ .Release.Name }}"
      }
    },
    "additionalProperties": false
  }
}